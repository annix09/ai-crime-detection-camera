<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Alert Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-2xl mb-4">Pending Alerts</h1>
  <div id="alerts"></div>

<script>
const BACKEND = "http://10.232.133.20:8000";

async function fetchAlerts(){
  const res = await fetch(BACKEND+'/api/alerts?status=pending');
  const data = await res.json();
  const container = document.getElementById('alerts');
  container.innerHTML = '';
  data.forEach(a => {
    const card = document.createElement('div');
    card.className = 'bg-white p-4 rounded shadow mb-2';
    card.id = a.id;
    card.innerHTML = `
      <div><strong>${a.cls}</strong> — ${Math.round(a.confidence*100)}%</div>
      <div>Location: ${a.location}</div>
      <div style="margin-top:6px;">
        <button onclick="actionAlert('${a.id}','confirm')" class="px-3 py-1 bg-green-600 text-white rounded">✔️ Confirm</button>
        <button onclick="actionAlert('${a.id}','reject')" class="px-3 py-1 bg-red-600 text-white rounded">❌ Reject</button>
      </div>
    `;
    container.appendChild(card);
  });
}

async function actionAlert(id, act){
  const res = await fetch(BACKEND+'/api/alerts/'+id+'/action',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({action: act, reviewer:'reviewer1'})
  });
  if(res.ok){
    document.getElementById(id).remove();
    alert(`Alert ${act}ed`);
  } else {
    alert('Failed to update alert');
  }
}

setInterval(fetchAlerts, 2000);
fetchAlerts();
</script>
</body>
</html>
